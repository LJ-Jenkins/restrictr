<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Ensure list elements are of a specific size and recycle them if not — schema_recycle • restrictr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Ensure list elements are of a specific size and recycle them if not — schema_recycle"><meta name="description" content="If any of the expressions in ..., evaluated within the data mask
.data (see rlang::args_data_masking), are
not of the same size, then the data element attempts to be recycled to
the size specified in the expression. The .names and .size
arguments can be used to check for given names and size of the
list. The checking of size and the recycling are from the vctrs
package (using vctrs::vec_size and vctrs::vec_recycle)
and thus apply the vctrs size rules
and vctrs recycling rules."><meta property="og:description" content="If any of the expressions in ..., evaluated within the data mask
.data (see rlang::args_data_masking), are
not of the same size, then the data element attempts to be recycled to
the size specified in the expression. The .names and .size
arguments can be used to check for given names and size of the
list. The checking of size and the recycling are from the vctrs
package (using vctrs::vec_size and vctrs::vec_recycle)
and thus apply the vctrs size rules
and vctrs recycling rules."><meta property="og:image" content="https://lj-jenkins.github.io/restrictr_test/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">restrictr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Ensure list elements are of a specific size and recycle them if not</h1>

      <div class="d-none name"><code>schema_recycle.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>If any of the expressions in <code>...</code>, evaluated within the data mask
<code>.data</code> (see <a href="https://rlang.r-lib.org/reference/args_data_masking.html" class="external-link">rlang::args_data_masking</a>), are
not of the same size, then the data element attempts to be recycled to
the size specified in the expression. The <code>.names</code> and <code>.size</code>
arguments can be used to check for given names and size of the
list. The checking of size and the recycling are from the <a href="https://vctrs.r-lib.org/" class="external-link">vctrs</a>
package (using <a href="https://vctrs.r-lib.org/reference/vec_size.html" class="external-link">vctrs::vec_size</a> and <a href="https://vctrs.r-lib.org/reference/vec_recycle.html" class="external-link">vctrs::vec_recycle</a>)
and thus apply the <a href="https://vctrs.r-lib.org/articles/type-size.html" class="external-link">vctrs size rules</a>
and <a href="https://vctrs.r-lib.org/reference/theory-faq-recycling.html" class="external-link">vctrs recycling rules</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">schema_recycle</span><span class="op">(</span><span class="va">.data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'list'</span></span>
<span><span class="fu">schema_recycle</span><span class="op">(</span></span>
<span>  <span class="va">.data</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .error_call <span class="op">=</span> <span class="fu">caller_env</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  .darg <span class="op">=</span> <span class="fu">caller_arg</span><span class="op">(</span><span class="va">.data</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--data">.data<a class="anchor" aria-label="anchor" href="#arg--data"></a></dt>
<dd><p>a list to use as the data mask.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>any number of R expressions to be evaluated using <code>.data</code>
as a data mask. Should follow the format of <code>named_element = expected_size</code>,
e.g, <code>var_x = 10</code> or <code>var_x = vctrs::vec_size(var_y)</code>.</p></dd>


<dt id="arg--names">.names<a class="anchor" aria-label="anchor" href="#arg--names"></a></dt>
<dd><p>optional character vector of names which must be
present in the <code>.data</code> data.frame/list. Can be a glue string.</p></dd>


<dt id="arg--size">.size<a class="anchor" aria-label="anchor" href="#arg--size"></a></dt>
<dd><p>optional positive scalar integerish value for the size that
the <code>.data</code> data.frame/list must have.</p></dd>


<dt id="arg--error-call">.error_call<a class="anchor" aria-label="anchor" href="#arg--error-call"></a></dt>
<dd><p>the call environment to use for error messages
(passed to <a href="https://rlang.r-lib.org/reference/abort.html" class="external-link">rlang::abort</a>).</p></dd>


<dt id="arg--darg">.darg<a class="anchor" aria-label="anchor" href="#arg--darg"></a></dt>
<dd><p>the argument name of <code>.data</code> to use in error messages.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Object <code>.data</code>, with named elements recycled to the desired size.
Also attaches class <code>with_schema</code> and attribute <code>schema</code> containing the
schema_recycle call to be enforced later.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>See <a href="schema.html">schema</a> and <a href="schema_cast.html">schema_cast</a>
for validation and casting, as well as <a href="recycle_if_not.html">recycle_if_not</a>
for a non-data-masked version of recycling. <a href="restrict.html">restrict</a>
can also be used for type casting, size recycling, and validation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># NB: Some of these examples are expected to produce an error. To</span></span></span>
<span class="r-in"><span><span class="co">#     prevent them from terminating a run with example() they are</span></span></span>
<span class="r-in"><span><span class="co">#     piped into a call to try().</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">li</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, y <span class="op">=</span> <span class="st">"hi"</span>, z <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">schema_recycle</span><span class="op">(</span><span class="va">li</span>, x <span class="op">=</span> <span class="fl">5</span>, y <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x y z </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 3 2 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># schema_recycle() follows `vctrs` recycling rules:</span></span></span>
<span class="r-in"><span><span class="fu">schema_recycle</span><span class="op">(</span><span class="va">li</span>, z <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in eval(expr, envir) : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="font-weight: bold;">Caused by error in `schema_recycle()`</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> In argument: `z = 6` for data mask `li`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> Can't recycle `z` (size 2) to size 6.</span>
<span class="r-in"><span><span class="co"># Error:</span></span></span>
<span class="r-in"><span><span class="co"># Caused by error in `schema_recycle()`:</span></span></span>
<span class="r-in"><span><span class="co"># ℹ In argument: `z = 6` for data mask `li`.</span></span></span>
<span class="r-in"><span><span class="co"># ! Can't recycle `z` (size 2) to size 6.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Other objects' lengths can be used as the size to</span></span></span>
<span class="r-in"><span><span class="co"># recycle to, e.g.:</span></span></span>
<span class="r-in"><span><span class="fu">schema_recycle</span><span class="op">(</span><span class="va">li</span>, x <span class="op">=</span> <span class="fu">vctrs</span><span class="fu">::</span><span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_size.html" class="external-link">vec_size</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># schema_recycle() works sequentially, so references to objects will be</span></span></span>
<span class="r-in"><span><span class="co"># after they have been evaluated:</span></span></span>
<span class="r-in"><span><span class="va">li</span><span class="op">$</span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">1.25</span></span></span>
<span class="r-in"><span><span class="fu">schema_recycle</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">li</span>,</span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="fu">vctrs</span><span class="fu">::</span><span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_size.html" class="external-link">vec_size</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  a <span class="op">=</span> <span class="fu">vctrs</span><span class="fu">::</span><span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_size.html" class="external-link">vec_size</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">$</span><span class="va">a</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `.names` and `.size` arguments can be used to check that given names</span></span></span>
<span class="r-in"><span><span class="co"># are present and that the data has the desired (vctrs) size:</span></span></span>
<span class="r-in"><span><span class="fu">schema_recycle</span><span class="op">(</span><span class="va">li</span>, .names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"b"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in eval(expr, envir) : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="font-weight: bold;">Caused by error in `schema_recycle()`</span>.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> Named element `b` not found in data mask `li`.</span>
<span class="r-in"><span><span class="co"># Error:</span></span></span>
<span class="r-in"><span><span class="co"># Caused by error in `schema_recycle()`.</span></span></span>
<span class="r-in"><span><span class="co"># ! Named elements `a` and `b` not found in data mask `li`.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">schema_recycle</span><span class="op">(</span><span class="va">li</span>, .size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in eval(expr, envir) : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="font-weight: bold;">Caused by error in `schema_recycle()`</span>.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> Object `li` is of <span style="color: #0000BB;">vctrs</span> size `4`, not `5`.</span>
<span class="r-in"><span><span class="co"># Error:</span></span></span>
<span class="r-in"><span><span class="co"># Caused by error in `schema_recycle()`.</span></span></span>
<span class="r-in"><span><span class="co"># ! Object `li` is of vctrs size `3`, not `5`.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The `.error_call` argument can be used to specify where the error occurs,</span></span></span>
<span class="r-in"><span><span class="co"># by default this is the caller environment.</span></span></span>
<span class="r-in"><span><span class="va">myfunc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">li</span>, <span class="va">...</span><span class="op">)</span> <span class="fu">schema_recycle</span><span class="op">(</span><span class="va">li</span>, <span class="va">...</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">myfunc</span><span class="op">(</span><span class="va">li</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in myfunc(li, x = -5) : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="font-weight: bold;">Caused by error in `schema_recycle()`</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> In argument: `x = -5` for data mask `li`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> Size argument is `-5`, needs to be positive scalar integerish.</span>
<span class="r-in"><span><span class="co"># Error in `myfunc()`:</span></span></span>
<span class="r-in"><span><span class="co"># Caused by error in `schema_recycle()`:</span></span></span>
<span class="r-in"><span><span class="co"># ℹ In argument: `x = -5` for data mask `li`.</span></span></span>
<span class="r-in"><span><span class="co"># ! Size argument is `-5`, needs to be positive scalar integerish.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Injection and glue can be used:</span></span></span>
<span class="r-in"><span><span class="va">li</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x_name</span> <span class="op">&lt;-</span> <span class="st">"x"</span></span></span>
<span class="r-in"><span><span class="fu">schema_recycle</span><span class="op">(</span><span class="va">li</span>, <span class="st">"{x_name}"</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "with_schema" "list"       </span>
<span class="r-in"><span><span class="fu">schema_recycle</span><span class="op">(</span><span class="va">li</span>, <span class="op">!</span><span class="op">!</span><span class="va">x_name</span> <span class="op">:=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "with_schema" "list"       </span>
<span class="r-in"><span><span class="fu">schema_recycle</span><span class="op">(</span><span class="va">li</span>, <span class="op">{</span><span class="op">{</span> <span class="va">x_name</span> <span class="op">}</span><span class="op">}</span> <span class="op">:=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "with_schema" "list"       </span>
<span class="r-in"><span><span class="va">x_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">schema_recycle</span><span class="op">(</span><span class="va">li</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">x_list</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "with_schema" "list"       </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Luke Jenkins.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

